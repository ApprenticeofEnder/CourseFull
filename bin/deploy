#!/bin/bash

ENV_FILE=$PWD/secrets/deploy.env.tpl

function secure-run () {
    op run --env-file=$ENV_FILE -- "$@"
}

secure-run docker compose down
cd client
secure-run pnpm build 
secure-run pnpm upload-assets
cd ..
secure-run docker compose up --build -d